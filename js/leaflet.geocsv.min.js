L.GeoCSV=L.GeoJSON.extend({options:{titles:["lat","lng","popup"],latitudeTitle:"lat",longitudeTitle:"lng",fieldSeparator:";",lineSeparator:"\n",deleteDoubleQuotes:true,firstLineTitles:false},_propertiesNames:[],initialize:function(a,b){this._propertiesNames=[];L.Util.setOptions(this,b);L.GeoJSON.prototype.initialize.call(this,a,b)},addData:function(c){if(typeof c==="string"){var a=this.options.titles;if(this.options.firstLineTitles){c=c.split(this.options.lineSeparator);if(c.length<2){return}a=c[0];c.splice(0,1);c=c.join(this.options.lineSeparator);a=a.trim().split(this.options.fieldSeparator);for(var b=0;b<a.length;b++){a[b]=this._deleteDoubleQuotes(a[b])}this.options.titles=a}for(var b=0;b<a.length;b++){var d=a[b].toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"_");if(d==""||d=="_"){d="prop-"+b}this._propertiesNames[b]=d}c=this._csv2json(c)}return L.GeoJSON.prototype.addData.call(this,c)},getPropertyName:function(a){var c=this.options.titles.indexOf(a),b="";if(c>=0){b=this._propertiesNames[c]}return b},getPropertyTitle:function(c){var b=this._propertiesNames.indexOf(c),a="";if(b>=0){a=this.options.titles[b]}return a},_deleteDoubleQuotes:function(a){if(this.options.deleteDoubleQuotes){a=a.trim().replace(/^"/,"").replace(/"$/,"")}return a},_csv2json:function(b){var h={};h.type="FeatureCollection";h.features=[];var d=this.options.titles;b=b.split(this.options.lineSeparator);for(var e=0;e<b.length;e++){var a=b[e].trim().split(this.options.fieldSeparator),g=parseFloat(a[d.indexOf(this.options.longitudeTitle)]),f=parseFloat(a[d.indexOf(this.options.latitudeTitle)]);if(a.length==d.length&&g<180&&g>-180&&f<90&&f>-90){var j={};j.type="Feature";j.geometry={};j.properties={};j.geometry["type"]="Point";j.geometry["coordinates"]=[g,f];for(var c=0;c<d.length;c++){if(d[c]!=this.options.latitudeTitle&&d[c]!=this.options.longitudeTitle){j.properties[this._propertiesNames[c]]=this._deleteDoubleQuotes(a[c])}}h.features.push(j)}}return h}});L.geoCsv=function(b,a){return new L.GeoCSV(b,a)};